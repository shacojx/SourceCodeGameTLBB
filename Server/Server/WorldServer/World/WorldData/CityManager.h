/////////////////////////////////////////////////////////////////////////////////
//文件名：CityManager.h
//功能描述：城市管理逻辑
/////////////////////////////////////////////////////////////////////////////////


#ifndef __CITYMANAGER_H__
#define __CITYMANAGER_H__


#include "Type.h"
#include "City.h"

class CityManager
{
public:
	struct CityManagerRT_t
	{
		//-------------------------------------------------------------------------------------------------
		//城市列表,供外部访问的数据接口
		City			m_Cities[MAX_CITY_PER_WORLD];
		//-------------------------------------------------------------------------------------------------
		//世界ID
		ID_t			m_WorldId;
	};

public :
	//-------------------------------------------------------------------------------------------------
	//内存分配，释放
	CityManager( ) ;
	~CityManager( ) ;

	//-------------------------------------------------------------------------------------------------
	//初始化,清空此城市管理器
	BOOL	Init( ) ;
	VOID	CleanUp( ) ;

	//-------------------------------------------------------------------------------------------------
	//new一个City
	City*	NewCity();

	//-------------------------------------------------------------------------------------------------
	//通过Guid获得城市
	City*	GetCityByGuid(_CITY_GUID CityGuid);

	//-------------------------------------------------------------------------------------------------
	//通过索引获得一个城市(用于遍历表中所有城市)
	City*	GetCityByIndex(INT nIndex);

	//-------------------------------------------------------------------------------------------------
	//删除城市
	BOOL	DelCityByGuid(_CITY_GUID CityGuid);

	//-------------------------------------------------------------------------------------------------
	//表中城市个数
	BOOL	GetCityNum(){ return m_pCityManagerDB->m_nFreePosition;}

	//-------------------------------------------------------------------------------------------------
	//逻辑处理
	BOOL	HeartBeat( UINT uTime=0 );

protected :
	//-------------------------------------------------------------------------------------------------
	//城市列表的真实数据
	CityManagerDB_t*	m_pCityManagerDB;
	//-------------------------------------------------------------------------------------------------
	//运行时信息
	CityManagerRT_t		m_CityManagerRT;

};

extern CityManager* g_pCityManager;
#endif
